<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruits</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Dark mode styles */
        body.dark .min-h-screen {
            background-color: #1a202c;
            background-image: none;
        }
        body.dark .bg-blue-600 {
            background-color: #2b6cb0;
        }
        body.dark .text-white {
            color: #e2e8f0;
        }
        body.dark .bg-gray-100 {
            background-color: #2d3748;
        }
        body.dark .bg-white {
            background-color: #2d3748;
        }
        body.dark .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        body.dark .text-gray-800 {
            color: #e2e8f0;
        }
        body.dark .tab-active {
            background-color: #3182ce;
        }
        body.dark .nav-container {
            background-color: #2d3748;
        }
        body.dark .bg-blue-500 {
            background-color: #3182ce;
        }
        body.dark .hover\:bg-blue-600:hover {
            background-color: #2c5282;
        }
        body.dark .border-gray-300 {
            border-color: #4a5568;
        }
        body.dark input {
            background-color: #4a5568;
            color: white;
        }
        body.dark .bg-gray-500 {
            background-color: #4a5568;
        }
        body.dark .tab {
            color: #e2e8f0;
        }
        body.dark .flashcard-mode-label {
            color: #e2e8f0;
        }

        /* Make the toggle non-selectable */
        .no-select {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Flashcard and other custom styles */
        html {
            overflow-y: scroll;
        }
        .tab-active {
            background-color: #2563eb;
            color: white;
        }
        .header-container {
            position: sticky;
            top: 0;
            z-index: 20;
            background-color: #2563eb;
            width: 100%;
        }
        .nav-container {
            position: sticky;
            top: 64px;
            z-index: 10;
            background-color: white;
            width: 100%;
            box-sizing: border-box;
        }
        body {
            padding-right: var(--scrollbar-width, 0px);
            box-sizing: border-box;
        }
        main {
            padding-top: calc(64px + 56px + 24px);
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            padding-bottom: 1.5rem;
        }
        #overview-section {
            margin-top: 1.5rem;
        }
        .flashcard {
            perspective: 1000px;
            width: 300px;
            height: 400px;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        body.dark .flashcard-front, body.dark .flashcard-back {
            background-color: #2d3748;
        }
        .flashcard-back {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="min-h-screen bg-gradient-to-b from-blue-50 to-gray-100 flex flex-col">
        <header class="header-container bg-blue-600 text-white p-4 shadow-lg flex justify-between items-center">
            <div class="max-w-md mx-auto w-full text-center">
                <h1 class="text-3xl font-bold">Fruits - Muutes</h1>
            </div>
            <div id="dark-mode-toggle" class="no-select absolute right-16 top-4 cursor-pointer text-white text-lg p-2 rounded-full hover:bg-blue-700 transition-colors duration-300">
                ☀️
            </div>
        </header>
        <nav class="nav-container shadow-md p-2">
            <div class="flex justify-between max-w-md mx-auto">
                <button id="overview-tab" class="tab tab-active px-4 py-2 text-sm font-semibold rounded hover:bg-blue-500 hover:text-white transition flex-1 text-center">Overview</button>
                <button id="flashcards-tab" class="tab px-4 py-2 text-sm font-semibold rounded hover:bg-blue-500 hover:text-white transition flex-1 text-center">Flash Cards</button>
                <button id="test-tab" class="tab px-4 py-2 text-sm font-semibold rounded hover:bg-blue-500 hover:text-white transition flex-1 text-center">Test Yourself</button>
            </div>
        </nav>
        <main class="container mx-auto p-6 flex-1">
            <section id="overview-section" class="grid grid-cols-1 gap-12 max-w-md mx-auto">
            </section>
            <section id="flashcards-section" class="hidden flex flex-col items-center max-w-md mx-auto">
                <div class="mb-4">
                    <label class="inline-flex items-center mr-4">
                        <input type="radio" name="flashcard-mode" value="random" checked class="mr-2">
                        <span class="flashcard-mode-label">Random</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="flashcard-mode" value="alphabetical" class="mr-2">
                        <span class="flashcard-mode-label">Alphabetical</span>
                    </label>
                </div>
                <div class="flashcard" id="flashcard-container">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <img id="flashcard-image" src="" alt="Animal" class="w-48 h-48 object-cover rounded mb-4">
                            <h2 class="text-xl font-semibold text-gray-800" id="flashcard-word"></h2>
                        </div>
                        <div class="flashcard-back">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4" id="flashcard-translation"></h2>
                            <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition" id="next-flashcard">Next Card</button>
                        </div>
                    </div>
                </div>
            </section>
            <section id="test-section" class="hidden flex flex-col items-center max-w-md mx-auto">
                <div class="bg-white rounded-lg shadow-md p-6 w-full">
                    <img id="test-image" src="" alt="Animal" class="w-48 h-48 object-cover rounded mb-4 mx-auto">
                    <input id="test-input" type="text" placeholder="Enter translation" class="border border-gray-300 rounded p-2 mb-4 w-full">
                    <div class="flex justify-between">
                        <button id="test-submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">Submit</button>
                        <button id="skip-test" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition">Skip</button>
                    </div>
                    <p id="test-feedback" class="text-lg mt-4 text-center"></p>
                </div>
                <div class="mt-4 text-center">
                    <p id="test-progress" class="text-gray-600"></p>
                </div>
            </section>
        </main>
    </div>
    <script>
        const animals = [
            { word: "Cherry", translation: "Scheri", image: "https://i.imgur.com/z4Yxbj6.png", link: "https://example.com/monkey" },
            { word: "Apple", translation: "Olmo", image: "https://i.imgur.com/fOOAupI.png", link: "https://example.com/dog" },
            { word: "Apricot", translation: "Lestö", image: "https://i.imgur.com/TIbpSym.png", link: "https://example.com/elephant" },
            { word: "Banana", translation: "Pata", image: "https://i.imgur.com/XVb9Oe9.png", link: "https://example.com/lion" },
            { word: "Blackberry", translation: "Bromülüm", image: "https://i.imgur.com/9h4RrXs.png", link: "https://example.com/lion" },
            { word: "Blueberry", translation: "Purpurülüm", image: "https://i.imgur.com/ikflvhK.png", link: "https://example.com/lion" },
            { word: "Dragon Fruit", translation: "Ed Muut", image: "https://i.imgur.com/xWoZtwX.png", link: "https://example.com/monkey" },
            { word: "Fig", translation: "Farg", image: "https://i.imgur.com/lxUxI7C.png", link: "https://example.com/dog" },
            { word: "Grape", translation: "Sebbi", image: "https://i.imgur.com/l5ygaIi.png", link: "https://example.com/elephant" },
            { word: "Kiwi", translation: "Bogga", image: "https://i.imgur.com/iGArN3L.png", link: "https://example.com/lion" },
            { word: "Lemon", translation: "Essi", image: "https://i.imgur.com/yElLZJa.png", link: "https://example.com/lion" },
            { word: "Lime", translation: "Essus", image: "https://i.imgur.com/2yUgcT8.png", link: "https://example.com/lion" },
            { word: "Mango", translation: "Duro", image: "https://i.imgur.com/ZBEWYT2.png", link: "https://example.com/monkey" },
            { word: "Orange", translation: "Naraning", image: "https://i.imgur.com/jaTqASA.png", link: "https://example.com/dog" },
            { word: "Papaya", translation: "Pap Muut", image: "https://i.imgur.com/Jlu8hPi.png", link: "https://example.com/elephant" },
            { word: "Peach", translation: "Sump", image: "https://i.imgur.com/2l6t5uq.png", link: "https://example.com/lion" },
            { word: "Pear", translation: "Körte", image: "https://i.imgur.com/iOUBYwU.png", link: "https://example.com/lion" },
            { word: "Pineapple", translation: "Baubet", image: "https://i.imgur.com/ROhG97R.png", link: "https://example.com/lion" },
            { word: "Plum", translation: "Siva", image: "https://i.imgur.com/Y5jTi9g.png", link: "https://example.com/dog" },
            { word: "Pomegranate", translation: "Grapping", image: "https://i.imgur.com/UiIDU6f.png", link: "https://example.com/elephant" },
            { word: "Raspberry", translation: "Himülüm", image: "https://i.imgur.com/9AYIZ7d.png", link: "https://example.com/lion" },
            { word: "Strawberry", translation: "Absürdülüm", image: "https://i.imgur.com/gSZv8RC.png", link: "https://example.com/lion" },
            { word: "Watermelon", translation: "Melo Offe Telo", image: "https://i.imgur.com/4JC4s19.png", link: "https://example.com/lion" },
            { word: "Coconut", translation: "Knoss", image: "https://i.imgur.com/FHnXsQ0.png", link: "https://example.com/dog" },
            { word: "Avocado", translation: "Meelbo", image: "https://i.imgur.com/8M2LBoh.png", link: "https://example.com/elephant" },
            { word: "Date", translation: "Brischit", image: "https://i.imgur.com/KCQm37W.png", link: "https://example.com/lion" }
        ];

        // DOM elements
        const overviewSection = document.getElementById('overview-section');
        const flashcardsSection = document.getElementById('flashcards-section');
        const testSection = document.getElementById('test-section');
        const overviewTab = document.getElementById('overview-tab');
        const flashcardsTab = document.getElementById('flashcards-tab');
        const testTab = document.getElementById('test-tab');
        
        // Flashcard elements
        const flashcardContainer = document.getElementById('flashcard-container');
        const flashcardImage = document.getElementById('flashcard-image');
        const flashcardWord = document.getElementById('flashcard-word');
        const flashcardTranslation = document.getElementById('flashcard-translation');
        const nextFlashcardBtn = document.getElementById('next-flashcard');
        
        // Test elements
        const testImage = document.getElementById('test-image');
        const testInput = document.getElementById('test-input');
        const testSubmit = document.getElementById('test-submit');
        const skipTestBtn = document.getElementById('skip-test');
        const testFeedback = document.getElementById('test-feedback');
        const testProgress = document.getElementById('test-progress');

        // Dark mode elements
        const toggleButton = document.getElementById('dark-mode-toggle');
        const body = document.body;

        // State variables
        let currentFlashcardIndex = 0;
        let recentlyTestedIndices = [];
        let recentlyFlashcardIndices = [];
        let flashcardMode = 'random'; // Default mode
        
        // Initialize the app
        function init() {
            animals.sort((a, b) => a.word.localeCompare(b.word));
            
            // Check for saved dark mode preference in local storage on page load
            const currentMode = localStorage.getItem('theme');
            if (currentMode === 'dark') {
                body.classList.add('dark');
                toggleButton.textContent = '🌙';
            }

            // Dark mode toggle event listener
            if (toggleButton) {
                toggleButton.addEventListener('click', () => {
                    body.classList.toggle('dark');
                    if (body.classList.contains('dark')) {
                        toggleButton.textContent = '🌙';
                        localStorage.setItem('theme', 'dark');
                    } else {
                        toggleButton.textContent = '☀️';
                        localStorage.setItem('theme', 'light');
                    }
                });
            } else {
                console.error('Dark mode toggle button not found');
            }

            preloadImages().then(() => {
                populateOverview();
                setupFlashcards();
                setupTest();
                showSection('overview-section');
            });
            
            // Set up event listeners for tabs
            if (overviewTab) overviewTab.addEventListener('click', () => showSection('overview-section'));
            else console.error('Overview tab not found');
            if (flashcardsTab) flashcardsTab.addEventListener('click', () => showSection('flashcards-section'));
            else console.error('Flashcards tab not found');
            if (testTab) testTab.addEventListener('click', () => showSection('test-section'));
            else console.error('Test tab not found');
            
            // Set up event listeners for mode toggle
            document.querySelectorAll('input[name="flashcard-mode"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    flashcardMode = e.target.value;
                    if (flashcardMode === 'random') {
                        recentlyFlashcardIndices = [];
                        currentFlashcardIndex = getRandomFlashcardIndex();
                    } else {
                        currentFlashcardIndex = 0; // Start from the beginning for alphabetical
                    }
                    showFlashcard();
                });
            });
            
            // Calculate scrollbar width to prevent layout shift
            const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
            document.documentElement.style.setProperty('--scrollbar-width', `${scrollbarWidth}px`);
        }
        
        // Preload all images to prevent loading issues
        function preloadImages() {
            return new Promise((resolve) => {
                let loaded = 0;
                animals.forEach(animal => {
                    const img = new Image();
                    img.src = animal.image;
                    img.onload = () => {
                        loaded++;
                        if (loaded === animals.length) resolve();
                    };
                    img.onerror = () => {
                        loaded++;
                        if (loaded === animals.length) resolve();
                    };
                });
            });
        }
        
        // Populate the overview section
        function populateOverview() {
            if (!overviewSection) {
                console.error('Overview section not found');
                return;
            }
            overviewSection.innerHTML = '';
            animals.forEach(animal => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md overflow-hidden transform transition hover:scale-105 min-h-[140px] flex flex-col items-center p-5';
                card.innerHTML = `
                    <div class="flex w-full items-center">
                        <div class="flex flex-col items-center">
                            <img src="${animal.image}" alt="${animal.word}" class="w-20 h-20 object-cover rounded mb-2">
                            <h3 class="text-lg font-semibold text-gray-800">${animal.word}</h3>
                        </div>
                        <div class="flex-1 flex flex-col items-end">
                            <h2 class="text-xl font-semibold text-gray-800 mb-1">${animal.translation}</h2>
                        </div>
                    </div>
                `;
                overviewSection.appendChild(card);
            });
        }
        
        // Set up flashcards functionality
        function setupFlashcards() {
            if (!flashcardContainer || !flashcardImage || !flashcardWord || !flashcardTranslation || !nextFlashcardBtn) {
                console.error('One or more flashcard elements not found');
                return;
            }
            // Start with a random card or first card based on mode
            if (flashcardMode === 'random') {
                currentFlashcardIndex = getRandomFlashcardIndex();
            } else {
                currentFlashcardIndex = 0;
            }
            showFlashcard();
            
            // Event listeners
            flashcardContainer.addEventListener('click', flipFlashcard);
            nextFlashcardBtn.addEventListener('click', nextFlashcard);
        }
        
        function showFlashcard() {
            if (!flashcardContainer || !flashcardImage || !flashcardWord || !flashcardTranslation) {
                console.error('One or more flashcard elements not found in showFlashcard');
                return;
            }
            const animal = animals[currentFlashcardIndex];
            flashcardImage.src = animal.image;
            flashcardWord.innerHTML = animal.word; // Use innerHTML to render <br>
            flashcardTranslation.textContent = animal.translation;
            flashcardContainer.classList.remove('flipped');
        }
        
        function flipFlashcard() {
            if (!flashcardContainer) {
                console.error('Flashcard container not found in flipFlashcard');
                return;
            }
            flashcardContainer.classList.toggle('flipped');
        }
        
        function getRandomFlashcardIndex() {
            const allIndices = animals.map((_, index) => index);
            const availableIndices = allIndices.filter(index => !recentlyFlashcardIndices.includes(index));
            
            if (availableIndices.length === 0) {
                recentlyFlashcardIndices = [];
                return Math.floor(Math.random() * animals.length);
            }
            
            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            recentlyFlashcardIndices.push(randomIndex);
            
            if (recentlyFlashcardIndices.length > 10) {
                recentlyFlashcardIndices.shift();
            }
            
            return randomIndex;
        }
        
        function nextFlashcard(event) {
            if (!flashcardContainer) {
                console.error('Flashcard container not found in nextFlashcard');
                return;
            }
            event.stopPropagation();
            const flashcardInner = flashcardContainer.querySelector('.flashcard-inner');
            if (!flashcardInner) {
                console.error('Flashcard inner element not found');
                return;
            }
            flashcardInner.style.transition = 'none';
            flashcardContainer.classList.remove('flipped');
            
            if (flashcardMode === 'random') {
                currentFlashcardIndex = getRandomFlashcardIndex();
            } else {
                currentFlashcardIndex = (currentFlashcardIndex + 1) % animals.length;
            }
            
            showFlashcard();
            
            void flashcardInner.offsetWidth;
            setTimeout(() => {
                flashcardInner.style.transition = 'transform 0.6s';
            }, 50);
        }
        
        // Set up test functionality
        function setupTest() {
            if (!testImage || !testInput || !testSubmit || !skipTestBtn || !testFeedback || !testProgress) {
                console.error('One or more test elements not found');
                return;
            }
            recentlyTestedIndices = [];
            currentTestIndex = getRandomTestIndex();
            showTestQuestion();
            
            testSubmit.addEventListener('click', checkAnswer);
            skipTestBtn.addEventListener('click', skipQuestion);
            testInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent form submission or other default behavior
                    checkAnswer();
                }
            });
        }
        
        function getRandomTestIndex() {
            const allIndices = animals.map((_, index) => index);
            const availableIndices = allIndices.filter(index => !recentlyTestedIndices.includes(index));
            
            if (availableIndices.length === 0) {
                recentlyTestedIndices = [];
                return Math.floor(Math.random() * animals.length);
            }
            
            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            recentlyTestedIndices.push(randomIndex);
            
            if (recentlyTestedIndices.length > 10) {
                recentlyTestedIndices.shift();
            }
            
            return randomIndex;
        }
        
        function showTestQuestion() {
            if (!testImage || !testInput || !testFeedback || !testProgress) {
                console.error('One or more test elements not found in showTestQuestion');
                return;
            }
            const animal = animals[currentTestIndex];
            testImage.src = animal.image;
            testInput.value = '';
            testFeedback.textContent = '';
            testInput.focus();
            updateTestProgress();
        }
        
        function checkAnswer() {
            if (!testSubmit || !testInput || !testFeedback) {
                console.error('One or more test elements not found in checkAnswer');
                return;
            }
            // Prevent multiple submissions
            if (testSubmit.disabled) return;
            
            const userInput = testInput.value.trim().toLowerCase();
            const correctAnswer = animals[currentTestIndex].translation.toLowerCase();
            
            if (userInput === correctAnswer) {
                testFeedback.textContent = 'Correct!';
                testFeedback.className = 'text-lg mt-4 text-center text-green-600';
                
                // Disable the submit button temporarily
                testSubmit.disabled = true;
                skipTestBtn.disabled = true;
                
                setTimeout(() => {
                    currentTestIndex = getRandomTestIndex();
                    showTestQuestion();
                    testSubmit.disabled = false;
                    skipTestBtn.disabled = false;
                }, 1000);
            } else {
                testFeedback.textContent = `Incorrect. The correct answer is "${animals[currentTestIndex].translation}".`;
                testFeedback.className = 'text-lg mt-4 text-center text-red-600';
                testInput.value = '';
            }
        }
        
        function skipQuestion() {
            currentTestIndex = getRandomTestIndex();
            showTestQuestion();
        }
        
        function updateTestProgress() {
            if (!testProgress) {
                console.error('Test progress element not found');
                return;
            }
            testProgress.textContent = `${animals.length} words in total`;
        }
        
        // Show/hide sections
        function showSection(sectionId) {
            const sections = {
                'overview-section': overviewSection,
                'flashcards-section': flashcardsSection,
                'test-section': testSection
            };
            const tabs = {
                'overview-section': overviewTab,
                'flashcards-section': flashcardsTab,
                'test-section': testTab
            };

            // Hide all sections and remove active class from tabs
            for (const [id, section] of Object.entries(sections)) {
                if (section) {
                    section.classList.add('hidden');
                } else {
                    console.error(`Section with ID ${id} not found`);
                }
            }
            for (const [id, tab] of Object.entries(tabs)) {
                if (tab) {
                    tab.classList.remove('tab-active');
                } else {
                    console.error(`Tab for ${id} not found`);
                }
            }

            // Show the selected section and activate its tab
            const targetSection = sections[sectionId];
            const targetTab = tabs[sectionId];
            if (targetSection) {
                targetSection.classList.remove('hidden');
            } else {
                console.error(`Target section ${sectionId} not found`);
            }
            if (targetTab) {
                targetTab.classList.add('tab-active');
            } else {
                console.error(`Target tab for ${sectionId} not found`);
            }

            if (sectionId === 'flashcards-section') {
                if (flashcardMode === 'random') {
                    currentFlashcardIndex = getRandomFlashcardIndex();
                } else {
                    currentFlashcardIndex = 0;
                }
                showFlashcard();
            } else if (sectionId === 'test-section') {
                setupTest();
            }
        }
        
        // Start the app
        window.onload = init;
    </script>
</body>
</html>
